"use strict";const e=require("../../../../common/vendor.js"),t=require("../function/deepMerge.js"),i=require("../function/test.js");const s=new class{setConfig(e){this.config=t.deepMerge(this.config,e)}request(t={}){if(this.interceptor.request&&"function"==typeof this.interceptor.request){let e=this.interceptor.request(t);if(!1===e)return new Promise((()=>{}));this.options=e}return t.dataType=t.dataType||this.config.dataType,t.responseType=t.responseType||this.config.responseType,t.url=t.url||"",t.params=t.params||{},t.header=Object.assign({},this.config.header,t.header),t.method=t.method||this.config.method,new Promise(((s,r)=>{t.complete=t=>{if(e.index.hideLoading(),clearTimeout(this.config.timer),this.config.timer=null,this.config.originalData)if(this.interceptor.response&&"function"==typeof this.interceptor.response){let e=this.interceptor.response(t);!1!==e?s(e):r(t)}else s(t);else if(200==t.statusCode)if(this.interceptor.response&&"function"==typeof this.interceptor.response){let e=this.interceptor.response(t.data);!1!==e?s(e):r(t.data)}else s(t.data);else r(t)},t.url=i.test.url(t.url)?t.url:this.config.baseUrl+(0==t.url.indexOf("/")?t.url:"/"+t.url),this.config.showLoading&&!this.config.timer&&(this.config.timer=setTimeout((()=>{e.index.showLoading({title:this.config.loadingText,mask:this.config.loadingMask}),this.config.timer=null}),this.config.loadingTime)),e.index.request(t)}))}constructor(){this.config={baseUrl:"",header:{},method:"POST",dataType:"json",responseType:"text",showLoading:!0,loadingText:"请求中...",loadingTime:800,timer:null,originalData:!1,loadingMask:!0},this.interceptor={request:null,response:null},this.get=(e,t={},i={})=>this.request({method:"GET",url:e,header:i,data:t}),this.post=(e,t={},i={})=>this.request({url:e,method:"POST",header:i,data:t}),this.put=(e,t={},i={})=>this.request({url:e,method:"PUT",header:i,data:t}),this.delete=(e,t={},i={})=>this.request({url:e,method:"DELETE",header:i,data:t})}};exports.http=s;
