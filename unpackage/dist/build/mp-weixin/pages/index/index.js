"use strict";const e=require("../../common/vendor.js");if(require("../../uni_modules/uni-id-pages/common/store.js"),require("../../uni_modules/uni-id-pages/config.js"),!Array){(e.resolveComponent("u-tabs")+e.resolveComponent("blog-item")+e.resolveComponent("uni-load-more"))()}Math||((()=>"../../uni_modules/vk-uview-ui/components/u-tabs/u-tabs.js")+(()=>"../../components/blog-item/blog-item.js")+(()=>"../../uni_modules/uni-load-more/components/uni-load-more/uni-load-more.js"))();const t={__name:"index",setup(t){let o=e.reactive([{name:"最新",type:"publish_date"},{name:"热门",type:"view_count"}]);const a=e.Es.database(),i=a.command;let n=e.reactive([]);const l=e.ref(0),r=e.ref("more"),u=e.ref(!1);e.onLoad((()=>{r.value="loading",s(),r.value="more"})),e.onPullDownRefresh((()=>{n.length=0,r.value="loading",u.value=!1,s(),r.value="more",e.index.stopPullDownRefresh()})),e.onReachBottom((()=>{r.value="loading",u.value?r.value="noMore":s()}));const s=()=>{let t=a.collection("board_article").where("delState != true").field("title,description,province,user_id,publish_date,picurls,comment_count,view_count,like_count").getTemp(),s=a.collection("uni-id-users").field("_id,username,nickname,avatar_file").getTemp();a.collection(t,s).orderBy(o[l.value].type,"desc").skip(n.length).limit(5).get().then((async t=>{0==t.result.data.length&&(u.value=!0,r.value="noMore");let o=t.result.data.map((e=>e._id));(await a.collection("board_like").where({article_id:i.in(o),user_id:e.Es.getCurrentUserInfo().uid}).get()).result.data.forEach((e=>{let o=t.result.data.findIndex((t=>e.article_id==t._id));t.result.data[o].isLike=!0})),n.push(...t.result.data)}))},d=e=>{l.value=e,n.length=0,r.value="more",u.value=!1,s()},c=()=>{e.index.navigateTo({url:"/pages/edit/edit"})};return(t,a)=>({a:e.o(d),b:e.p({list:e.unref(o),current:l.value,"active-color":"#0f505e",inactiveColor:"#888"}),c:e.f(e.unref(n),((t,o,a)=>({a:"a005dd92-1-"+a,b:e.p({item:t}),c:t._id}))),d:e.o(c),e:e.p({color:"#0f505e",status:r.value})})}},o=e._export_sfc(t,[["__scopeId","data-v-a005dd92"]]);wx.createPage(o);
