"use strict";const e=require("../../common/vendor.js"),t=require("../../utils/tools.js"),o=require("../../uni_modules/uni-id-pages/common/store.js");if(require("../../uni_modules/uni-id-pages/config.js"),!Array){(e.resolveComponent("comment-item")+e.resolveComponent("uni-load-more")+e.resolveComponent("comment-frame"))()}Math||((()=>"../../components/comment-item/comment-item.js")+(()=>"../../uni_modules/uni-load-more/components/uni-load-more/uni-load-more.js")+(()=>"../../components/comment-frame/comment-frame.js"))();const n={__name:"reply",setup(n){const r=e.Es.database();let i={};const m=e.reactive([]),a=e.reactive({article_id:"",comment_type:1,reply_user_id:"",reply_comment_id:""}),l=e.ref("more"),c=e.ref(!1),d=()=>{let e=r.collection("board_comment").where(`article_id == '${i.article_id}' && \n\t\tcomment_type == 1  && reply_comment_id == '${i._id}'`).orderBy("comment_date desc").skip(m.length).limit(5).getTemp(),t=r.collection("uni-id-users").field("_id,nickname,username,avatar_file").getTemp();r.collection(e,t).get().then((e=>{0==e.result.data.length&&(c.value=!0,l.value="noMore"),m.push(...e.result.data)}))};e.onReachBottom((()=>{l.value="loading",c.value?l.value="noMore":d()}));const s=e=>{m.unshift({...e,...a,user_id:[o.store.userInfo],comment_date:Date.now()})},u=e=>{let t=m.findIndex((t=>t._id==e));m.splice(t,1)};return e.onLoad((()=>{let t=e.index.getStorageSync("replyItem");if(!t)return e.index.navigateBack();i=e.reactive(t),a.article_id=i.article_id,a.reply_comment_id=i._id,a.reply_user_id=i.user_id[0]._id,l.value="loading",d(),l.value="more"})),e.onUnload((()=>{e.index.removeStorageSync("replyItem")})),(o,n)=>({a:e.p({closeBtn:!0,childState:!0,item:e.unref(i)}),b:e.f(m,((t,o,n)=>({a:"af2807dd-1-"+n,b:e.p({childState:!0,item:t})}))),c:e.o(u),d:e.p({color:"#0f505e",status:l.value}),e:e.o(s),f:e.p({placeholder:`回复：${e.unref(t.getName)(e.unref(i))}`,comment:a})})}},r=e._export_sfc(n,[["__scopeId","data-v-af2807dd"]]);wx.createPage(r);
