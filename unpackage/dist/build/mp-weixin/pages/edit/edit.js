"use strict";const e=require("../../common/vendor.js"),t=require("../../utils/tools.js");if(!Array){e.resolveComponent("u-button")()}Math;const a={__name:"edit",setup(a){const i=e.Es.database(),o=e.reactive({title:"",content:"",description:"",picurls:"",province:""});let n="";const l=e.ref(!1),r=e.ref(!1),s=e.ref(!1),c=e.ref(!1),d=e.ref(""),u=e.getCurrentInstance();e.onLoad((e=>{d.value=e.id,t.getProvince().then((e=>{o.province=e})),g()}));const v=()=>{e.index.createSelectorQuery().in(u).select(".richTextEditor").fields({size:!0,context:!0},(e=>{n=e.context})).exec()},h=e=>{((e,t,a)=>{t.hasOwnProperty(e)?a.value=!0:a.value=!1})("header",e.detail,r)},p=()=>{e.index.chooseImage({success:async t=>{for(let a of t.tempFiles){let t=a.path.substring(a.path.lastIndexOf(".")),i=Date.now()+""+String(Math.random()).substr(3,6)+t;e.index.showLoading({title:"上传中",mask:!0});let o=await e.Es.uploadFile({filePath:a.path,cloudPath:a.name||i});n.insertImage({src:o.fileID}),e.index.hideLoading()}}})},x=()=>{n.getContents({success:a=>{o.content=a.html,o.description=a.text.slice(0,50),o.picurls=t.getImgSrc(a.html),e.index.showLoading({title:"发布中"}),m()}})},g=()=>{d.value&&i.collection("board_article").doc(d.value).get().then((e=>{o.title=e.result.data[0].title,o.content=e.result.data[0].content,L()}))},m=()=>{d.value?i.collection("board_article").doc(d.value).update(o).then((t=>{e.index.hideLoading(),e.index.showToast({title:"修改成功"}),setTimeout((()=>{e.index.navigateTo({url:"/pages/index/index"})}),900)})):i.collection("board_article").add(o).then((t=>{e.index.hideLoading(),e.index.showToast({title:"发布成功"}),setTimeout((()=>{e.index.reLaunch({url:"/pages/index/index"})}),900)}))},f=()=>{l.value=!0},b=()=>{r.value=!r.value,n.format("header",!!r&&"H2")},_=()=>{s.value=!s.value,n.format("bold")},w=()=>{c.value=!c.value,n.format("italic")},I=()=>{n.insertDivider()},L=()=>{n.setContents({html:o.content})},y=()=>{l.value=!l.value};return(t,a)=>e.e({a:o.title,b:e.o((e=>o.title=e.detail.value)),c:e.o(v),d:e.o(f),e:e.o(h),f:e.o(x),g:e.p({type:"primary",disabled:!o.title.length}),h:l.value},l.value?{i:e.n(r.value?"active":""),j:e.o(b),k:e.n(s.value?"active":""),l:e.o(_),m:e.n(c.value?"active":""),n:e.o(w),o:e.o(I),p:e.o(p),q:e.o(y)}:{})}},i=e._export_sfc(a,[["__scopeId","data-v-08acf838"]]);wx.createPage(i);
