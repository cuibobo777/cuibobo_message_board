"use strict";const e=require("../common/vendor.js");const t=e.Es.database(),i=e.Es.importObject("utilsObject",{customUI:!0});exports.getAvatar=function(e){var t,i,r;return null!=(r=null==(i=null==(t=e.user_id[0])?void 0:t.avatar_file)?void 0:i.url)?r:"../../static/images/my_fill.png"},exports.getImgSrc=function(e,t=3){let i=[];return e.replace(/<img [^>]*src=['"]([^'"]+)[^>*]/g,((e,t)=>{i.push(t)})),i=i.slice(0,t),i},exports.getName=function(e){return e.user_id[0].nickname||e.user_id[0].username||e.user_id[0].mobile||"请设置昵称"},exports.getProvince=function(){return new Promise(((t,i)=>{let r=e.index.getStorageSync("hisProvince");r&&Date.now()-r.time<36e5?t(r.province):new Promise(((t,i)=>{e.index.request({url:"https://restapi.amap.com/v3/ip?key=cffea5404e0689048feeab6b5af21bef",success:i=>{let r="";r="string"==typeof i.data.province?i.data.province:"艾欧泽亚",t(r);let o={province:r,time:Date.now()};e.index.setStorageSync("hisProvince",o)},fail:e=>{i(e)}})})).then((e=>{t(e)})).catch((e=>{i(e)}))}))},exports.likeFun=async function(e){(await t.collection("board_like").where(`article_id=="${e}" && user_id==$cloudEnv_uid`).count()).result.total?(t.collection("board_like").where(`article_id=="${e}" && user_id==$cloudEnv_uid`).remove(),i.operation("board_article","like_count",e,-1)):(t.collection("board_like").add({article_id:e}),i.operation("board_article","like_count",e,1))};
