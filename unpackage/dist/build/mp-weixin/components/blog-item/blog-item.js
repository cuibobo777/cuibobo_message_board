"use strict";const e=require("../../common/vendor.js"),i=require("../../utils/tools.js"),t=require("../../uni_modules/uni-id-pages/common/store.js");if(require("../../uni_modules/uni-id-pages/config.js"),!Array){(e.resolveComponent("uni-dateformat")+e.resolveComponent("uni-icons")+e.resolveComponent("u-action-sheet"))()}Math||((()=>"../../uni_modules/uni-dateformat/components/uni-dateformat/uni-dateformat.js")+(()=>"../../uni_modules/uni-icons/components/uni-icons/uni-icons.js")+(()=>"../../uni_modules/vk-uview-ui/components/u-action-sheet/u-action-sheet.js"))();const o={__name:"blog-item",props:{item:{type:Object}},setup(o){const n=o,s=e.Es.database(),d=e.ref(!1),a=e.ref(!0),l=e.ref(0),u=e.reactive([{text:"修改",type:"edit",disabled:!0},{text:"删除",type:"del",color:"#f56c6c",disabled:!0}]),r=()=>{var i,t,o;let s=e.Es.getCurrentUserInfo().uid;(null==(i=n.item)?void 0:i.user_id[0]._id)!=s&&"webmaster"!=(null==(t=e.Es.getCurrentUserInfo())?void 0:t.role[0])&&"admin"!=(null==(o=e.Es.getCurrentUserInfo())?void 0:o.role[0])||u.forEach((e=>{e.disabled=!1})),d.value=!0},m=e=>{"del"==u[e].type?v():"edit"==u[e].type&&p()},c=()=>{t.store.hasLogin||e.index.showModal({title:"是否前往登录",success:i=>{var t;i.confirm&&e.index.navigateTo({url:"/"+(null==(t=e.pageJson.uniIdRouter)?void 0:t.loginPage)})}});let o=Date.now();o-l.value<1e3?e.index.showToast({title:"操作太频繁，请稍后...",icon:"none"}):(n.item.isLike?n.item.like_count--:n.item.like_count++,n.item.isLike=!n.item.isLike,l.value=o,i.likeFun(n.item._id))},p=()=>{console.log(n.item._id),e.index.navigateTo({url:"/pages/edit/edit?id="+n.item._id})},v=()=>{e.index.showLoading({title:"删除中..."}),s.collection("board_article").doc(n.item._id).update({delState:!0}).then((i=>{a.value=!1,e.index.hideLoading(),e.index.showToast({title:"删除成功",icon:"none"})})).catch((i=>{e.index.hideLoading()}))},_=()=>{e.index.navigateTo({url:"/pages/detail/detail?id="+n.item._id})};return(t,s)=>e.e({a:a.value},a.value?e.e({b:e.unref(i.getAvatar)(o.item),c:e.t(e.unref(i.getName)(o.item)),d:e.p({date:o.item.publish_date,format:"MM月dd hh:mm",threshold:[6e4,2592e6]}),e:e.p({type:"more-filled",size:"20"}),f:e.o(r),g:e.t(o.item.title),h:e.o(_),i:o.item.description},o.item.description?{j:e.t(o.item.description)}:{},{k:e.o(_),l:o.item.picurls.length},o.item.picurls.length?{m:e.f(o.item.picurls,((i,t,o)=>({a:e.o((i=>{e.index.previewImage({urls:n.item.picurls,current:indexs})}),t),b:i,c:t})))}:{},{n:e.t(o.item.view_count),o:e.o(_),p:e.t(o.item.comment_count?o.item.comment_count:"评论"),q:e.t(o.item.like_count?o.item.like_count:"点赞"),r:e.o(c),s:e.n(o.item.isLike?"active":""),t:e.o(m),v:e.o((e=>d.value=e)),w:e.p({list:u,"cancel-btn":!0,"mask-close-able":!0,"border-radius":25,modelValue:d.value})}):{})}},n=e._export_sfc(o,[["__scopeId","data-v-fcdb8dc2"]]);wx.createComponent(n);
